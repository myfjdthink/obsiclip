# ObsiClip Popup é‡æ„è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

å°† ObsiClip ä» Sidepanel æ¨¡å¼æ”¹ä¸º Popup æ¨¡å¼ï¼Œé…ç½®é¡¹ç§»è‡³ç‹¬ç«‹çš„ Settings é¡µé¢ã€‚

## äº¤äº’æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»æ‰©å±•å›¾æ ‡
    â†“
Popup æ‰“å¼€ï¼Œè‡ªåŠ¨æå–é¡µé¢å†…å®¹
    â†“
æ˜¾ç¤ºåœ¨"åŸå§‹å†…å®¹" Tabï¼ˆsourceã€titleã€æ­£æ–‡é¢„è§ˆï¼‰
    â†“
ç”¨æˆ·ç¡®è®¤å†…å®¹æ­£ç¡®ï¼Œç‚¹å‡»"AI æ•´ç†" Tab
    â†“
è§¦å‘ AI æ•´ç†ï¼Œç”Ÿæˆæ ‡é¢˜ã€åˆ†ç±»ã€æ€»ç»“
    â†“
ç”¨æˆ·å¯ç¼–è¾‘æ•´ç†ç»“æœ
    â†“
ç‚¹å‡»ä¿å­˜
```

## å½“å‰æ¶æ„

```
entrypoints/
â”œâ”€â”€ popup/          # å½“å‰ä»…ä½œä¸ºå…¥å£ï¼ŒåŠŸèƒ½ç®€å•
â”œâ”€â”€ sidepanel/      # ä¸»è¦åŠŸèƒ½åŒºï¼ˆå°†åºŸå¼ƒï¼‰
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ RawContentTab.vue   # åŸå§‹å†…å®¹ Tab
â”‚       â”œâ”€â”€ AiPreviewTab.vue    # AI æ•´ç† Tab
â”‚       â””â”€â”€ SaveFooter.vue      # ä¿å­˜åŒºåŸŸ
â”œâ”€â”€ options/        # è®¾ç½®é¡µé¢ï¼ˆå°†é‡æ„ï¼‰
â”œâ”€â”€ background.ts
â””â”€â”€ content.ts
```

## ç›®æ ‡æ¶æ„

```
entrypoints/
â”œâ”€â”€ popup/                    # ä¸»åŠŸèƒ½åŒºï¼ˆä» sidepanel è¿ç§»ï¼‰
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ main.ts
â”‚   â”œâ”€â”€ App.vue
â”‚   â”œâ”€â”€ style.css
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ HeaderMenu.vue      # é¡¶éƒ¨èœå•æ 
â”‚   â”‚   â”œâ”€â”€ RawContentTab.vue   # åŸå§‹å†…å®¹ Tabï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ AiPreviewTab.vue    # AI æ•´ç† Tabï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â””â”€â”€ SaveFooter.vue      # ä¿å­˜åŒºåŸŸï¼ˆå¤ç”¨ï¼‰
â”‚   â””â”€â”€ composables/            # ä» sidepanel è¿ç§»
â”‚       â”œâ”€â”€ useContent.ts
â”‚       â”œâ”€â”€ useObsidian.ts
â”‚       â””â”€â”€ useSettings.ts
â”œâ”€â”€ settings/                 # ç‹¬ç«‹é…ç½®é¡µé¢ï¼ˆæ–°å»ºï¼‰
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ main.ts
â”‚   â”œâ”€â”€ App.vue
â”‚   â””â”€â”€ style.css
â”œâ”€â”€ background.ts             # ç®€åŒ–ï¼Œç§»é™¤ sidePanel é€»è¾‘
â””â”€â”€ content.ts                # ä¿æŒä¸å˜
```

## Popup é¡µé¢å¸ƒå±€

é‡‡ç”¨ Tab åˆ‡æ¢æ¨¡å¼ï¼Œå¤ç”¨ç°æœ‰ sidepanel çš„ç»„ä»¶ç»“æ„ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ObsiClip              [ğŸ”„] [âš™ï¸]     â”‚  â† HeaderMenu
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ source: https://...                 â”‚
â”‚ title: åŸå§‹é¡µé¢æ ‡é¢˜                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [åŸå§‹å†…å®¹]  [AI æ•´ç†]    â† Tab åˆ‡æ¢  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ å½“å‰ Tab çš„å†…å®¹                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¿å­˜åˆ°: [è·¯å¾„]          [ä¿å­˜]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tab è¯´æ˜

#### åŸå§‹å†…å®¹ Tab (RawContentTab.vue)
- æ˜¾ç¤ºæå–çš„ç½‘é¡µæ­£æ–‡ï¼ˆåªè¯»é¢„è§ˆï¼‰
- ç”¨æˆ·åœ¨æ­¤ç¡®è®¤å†…å®¹æ˜¯å¦æ­£ç¡®
- åˆ·æ–°æŒ‰é’®ï¼šé‡æ–°æå–é¡µé¢å†…å®¹

#### AI æ•´ç† Tab (AiPreviewTab.vue)
- é¦–æ¬¡åˆ‡æ¢åˆ°æ­¤ Tab æ—¶è§¦å‘ AI æ•´ç†
- æ•´ç†å®Œæˆåæ˜¾ç¤ºï¼š
  - æ ‡é¢˜ï¼ˆå¯ç¼–è¾‘ï¼‰
  - åˆ†ç±»ï¼ˆå¯ç¼–è¾‘ï¼‰
  - æ€»ç»“æ­£æ–‡ï¼ˆå¯ç¼–è¾‘ï¼‰
- æ•´ç†ä¸­æ˜¾ç¤º loading çŠ¶æ€

### ç»„ä»¶è¯´æ˜

#### HeaderMenu.vue
- ä½ç½®ï¼šé¡¶éƒ¨
- å…ƒç´ ï¼š
  - Logo/æ ‡é¢˜ï¼ˆå·¦ä¾§ï¼‰
  - åˆ·æ–°æŒ‰é’® ğŸ”„ - é‡æ–°æå–é¡µé¢å†…å®¹ï¼Œé‡ç½®åˆ°åŸå§‹å†…å®¹ Tab
  - é…ç½®æŒ‰é’® âš™ï¸ - æ‰“å¼€ settings é¡µé¢
  - ï¼ˆTODOï¼‰æ‰‹åŠ¨é€‰å–æ¨¡å¼æŒ‰é’® - æœ¬ç‰ˆæœ¬ä¸å®ç°

#### SaveFooter.vue
- æ–‡ä»¶å¤¹è¾“å…¥ï¼šæ”¯æŒå†å²è®°å½•ä¸‹æ‹‰
- ä¿å­˜æŒ‰é’®ï¼šè°ƒç”¨ Obsidian URI ä¿å­˜
- ä¿å­˜æŒ‰é’®çŠ¶æ€ï¼šAI æ•´ç†å®Œæˆå‰ç¦ç”¨

## Settings é¡µé¢å¸ƒå±€

ç‹¬ç«‹çš„é…ç½®é¡µé¢ï¼Œé€šè¿‡æ–°æ ‡ç­¾é¡µæ‰“å¼€ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¿”å›                    è®¾ç½®      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ API é…ç½®                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æœåŠ¡å•†: [OpenAI â–¼]              â”‚ â”‚
â”‚ â”‚ API Key: [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]           â”‚ â”‚
â”‚ â”‚ Base URL: [å¯é€‰]                â”‚ â”‚
â”‚ â”‚ Model: [gpt-4o â–¼]               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ Prompt é…ç½®                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ è‡ªå®šä¹‰ Prompt å†…å®¹              â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯å®ç°

### 1. Manifest å˜æ›´ (wxt.config.ts)

```typescript
manifest: {
  name: 'ObsiClip',
  permissions: ['activeTab', 'storage', 'scripting'],
  // ç§»é™¤ sidePanel æƒé™
  action: {
    default_popup: 'popup.html',
    default_icon: { ... }
  },
  // ç§»é™¤ side_panel é…ç½®
}
```

### 2. å¤ç”¨ç°æœ‰ä»£ç 

| ç°æœ‰æ–‡ä»¶ | å¤ç”¨æ–¹å¼ |
|---------|---------|
| `utils/storage.ts` | ç›´æ¥å¤ç”¨ |
| `utils/llm.ts` | ç›´æ¥å¤ç”¨ |
| `utils/extractor.ts` | ç›´æ¥å¤ç”¨ |
| `utils/obsidian.ts` | ç›´æ¥å¤ç”¨ |
| `sidepanel/components/RawContentTab.vue` | è¿ç§»åˆ° popup |
| `sidepanel/components/AiPreviewTab.vue` | è¿ç§»åˆ° popup |
| `sidepanel/components/SaveFooter.vue` | è¿ç§»åˆ° popup |
| `sidepanel/composables/*` | è¿ç§»åˆ° popup |

### 3. Background å˜æ›´

```typescript
// ç§»é™¤ sidePanel ç›¸å…³ä»£ç 
// ä¿ç•™ AI_PROCESS å’Œ OPEN_OBSIDIAN_URL æ¶ˆæ¯å¤„ç†
```

### 4. Settings é¡µé¢è·¯ç”±

```typescript
const openSettings = () => {
  browser.tabs.create({
    url: browser.runtime.getURL('settings.html')
  });
};
```

## æ•°æ®æµ

```
ç”¨æˆ·ç‚¹å‡»æ‰©å±•å›¾æ ‡
    â†“
Popup æ‰“å¼€
    â†“
è‡ªåŠ¨æå–é¡µé¢å†…å®¹ (content.ts â†’ EXTRACT_CONTENT)
    â†“
æ˜¾ç¤ºåŸå§‹å†…å®¹ Tab
    â†“
ç”¨æˆ·åˆ‡æ¢åˆ° AI æ•´ç† Tab
    â†“
è§¦å‘ AI æ•´ç† (background.ts â†’ AI_PROCESS)
    â†“
æ˜¾ç¤ºæ•´ç†ç»“æœ
    â†“
ç”¨æˆ·ç¼–è¾‘/ä¿å­˜ (obsidian.ts)
```

## æ ·å¼å‚è€ƒ

```css
:root {
  --popup-width: 380px;
  --popup-height: 520px;
  --background-primary: #ffffff;
  --background-secondary: #f5f5f5;
  --text-normal: #1a1a1a;
  --text-muted: #666666;
  --interactive-accent: #7c3aed;
  --border-color: #e5e5e5;
  --radius-m: 8px;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background-primary: #1e1e1e;
    --background-secondary: #2d2d2d;
    --text-normal: #dcddde;
    --text-muted: #999999;
    --border-color: #404040;
  }
}
```

## è¿ç§»æ­¥éª¤

### Phase 1: é‡æ„ Popup é¡µé¢
1. å°† `sidepanel/components/*` è¿ç§»åˆ° `popup/components/`
2. å°† `sidepanel/composables/*` è¿ç§»åˆ° `popup/composables/`
3. é‡å†™ `popup/App.vue`ï¼Œå®ç° Tab åˆ‡æ¢å¸ƒå±€
4. æ–°å¢ `popup/components/HeaderMenu.vue`
5. è°ƒæ•´æ ·å¼é€‚é… popup å°ºå¯¸

### Phase 2: åˆ›å»º Settings é¡µé¢
1. æ–°å»º `entrypoints/settings/` ç›®å½•
2. ä» `options/App.vue` æå– API Key å’Œ Prompt é…ç½®éƒ¨åˆ†
3. ç®€åŒ–ä¸ºåªä¿ç•™è¿™ä¸¤ä¸ªé…ç½®é¡¹

### Phase 3: æ¸…ç†
1. åˆ é™¤ `sidepanel/` ç›®å½•
2. åˆ é™¤ `options/` ç›®å½•
3. æ›´æ–° `wxt.config.ts`ï¼Œç§»é™¤ sidePanel é…ç½®
4. ç®€åŒ– `background.ts`ï¼Œç§»é™¤ sidePanel ç›¸å…³ä»£ç 

## å¾…å®šäº‹é¡¹

- [ ] æ‰‹åŠ¨é€‰å–æ¨¡å¼ï¼ˆæœ¬ç‰ˆæœ¬ä¸å®ç°ï¼‰
- [ ] åˆ†ç±»é€‰é¡¹çš„é…ç½®æ–¹å¼
- [ ] å†å²è®°å½•çš„å­˜å‚¨å’Œå±•ç¤º
- [ ] æ·±è‰²æ¨¡å¼æ”¯æŒ
